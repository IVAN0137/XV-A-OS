document.addEventListener("DOMContentLoaded", () => {
    const preloader = document.getElementById("preloader")
    const invitation = document.getElementById("invitation")
    const quinceaneraNombre = document.getElementById("quinceanera-name")
    const playMusicBtn = document.getElementById("playMusic")
    const bgMusic = document.getElementById("bgMusic")
  
    // Declare gsap variable
    const gsap = window.gsap
  
    function hidePreloader() {
      preloader.style.opacity = "0"
      preloader.style.transition = "opacity 0.5s ease"
      setTimeout(() => {
        preloader.style.display = "none"
        invitation.classList.remove("hidden")
        initializeInvitation()
      }, 500)
    }
  
    function initializeInvitation() {
      animateQuinceaneraName()
      initializeCountdown()
      initializeGallery()
      initializeAnimations()
      initializeRSVPForm()
      initializeNavbar()
      initializeAudio()
    }
  
    function animateQuinceaneraName() {
      const text = quinceaneraNombre.textContent
      quinceaneraNombre.textContent = ""
      quinceaneraNombre.style.opacity = "1"
  
      for (let i = 0; i < text.length; i++) {
        const span = document.createElement("span")
        span.textContent = text[i]
        span.style.opacity = "0"
        span.style.display = "inline-block"
        quinceaneraNombre.appendChild(span)
  
        gsap.to(span, {
          opacity: 1,
          duration: 0.1,
          delay: i * 0.1,
          ease: "power1.inOut",
        })
      }
    }
  
    function initializeCountdown() {
      const countDownDate = new Date("Apr 26, 2025 15:15:00").getTime()
      const countdownFunction = setInterval(() => {
        const now = new Date().getTime()
        const distance = countDownDate - now
  
        const days = Math.floor(distance / (1000 * 60 * 60 * 24))
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60))
        const seconds = Math.floor((distance % (1000 * 60)) / 1000)
  
        document.getElementById("days").innerHTML = days
        document.getElementById("hours").innerHTML = hours
        document.getElementById("minutes").innerHTML = minutes
        document.getElementById("seconds").innerHTML = seconds
  
        updateCountdownCircle("days", days, 365)
        updateCountdownCircle("hours", hours, 24)
        updateCountdownCircle("minutes", minutes, 60)
        updateCountdownCircle("seconds", seconds, 60)
  
        if (distance < 0) {
          clearInterval(countdownFunction)
          document.getElementById("countdown").innerHTML = "<h4>Â¡El gran dÃ­a ha llegado!</h4>"
        }
      }, 1000)
    }
  
    function updateCountdownCircle(id, time, max) {
      const circle = document.getElementById(`${id}-circle`)
      if (circle) {
        const radius = circle.r.baseVal.value
        const circumference = radius * 2 * Math.PI
        const offset = circumference - (time / max) * circumference
        circle.style.strokeDasharray = `${circumference} ${circumference}`
        circle.style.strokeDashoffset = offset
      }
    }
  
    function initializeGallery() {
      new Swiper(".gallery-carousel", {
        effect: "coverflow",
        grabCursor: true,
        centeredSlides: true,
        slidesPerView: "auto",
        coverflowEffect: {
          rotate: 50,
          stretch: 0,
          depth: 100,
          modifier: 1,
          slideShadows: true,
        },
        pagination: {
          el: ".swiper-pagination",
        },
        navigation: {
          nextEl: ".swiper-button-next",
          prevEl: ".swiper-button-prev",
        },
      })
    }
  
    function initializeAnimations() {
      gsap.registerPlugin(ScrollTrigger)
  
      gsap.utils.toArray(".section").forEach((section) => {
        gsap.from(section, {
          opacity: 0,
          y: 50,
          duration: 1,
          scrollTrigger: {
            trigger: section,
            start: "top 80%",
            end: "bottom 20%",
            toggleActions: "play none none reverse",
          },
        })
      })
  
      gsap.from(".timeline-item", {
        opacity: 0,
        x: (index) => (index % 2 === 0 ? -50 : 50),
        stagger: 0.2,
        duration: 1,
        scrollTrigger: {
          trigger: ".timeline",
          start: "top 80%",
          end: "bottom 20%",
          toggleActions: "play none none reverse",
        },
      })
    }
  
    function initializeRSVPForm() {
      const rsvpForm = document.getElementById("rsvpForm")
      if (rsvpForm) {
        rsvpForm.addEventListener("submit", function (e) {
          e.preventDefault()
          const attendance = document.getElementById("attendance").value
          this.innerHTML = '<h4 class="success-message">Â¡Gracias por confirmar!</h4>'
          setTimeout(() => {
            const message =
              attendance === "si"
                ? "Â¡Hola! Confirmo mi asistencia a la celebraciÃ³n de XV aÃ±os de Ashley Yajaira. Â¡Gracias por la invitaciÃ³n!"
                : "Â¡Hola! Lamento no poder asistir a la celebraciÃ³n de XV aÃ±os de Ashley Yajaira. Â¡Que tengan una hermosa fiesta!"
            window.location.href = `https://wa.me/1234567890?text=${encodeURIComponent(message)}`
          }, 2000)
        })
      }
    }
  
    function initializeNavbar() {
      const navbar = document.getElementById("navbar")
      let lastScrollTop = 0
      window.addEventListener("scroll", () => {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop
        if (scrollTop > lastScrollTop) {
          navbar.style.top = "-80px"
        } else {
          navbar.style.top = "0"
        }
        lastScrollTop = scrollTop
      })
  
      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
          e.preventDefault()
          const targetElement = document.querySelector(this.getAttribute("href"))
          if (targetElement) {
            targetElement.scrollIntoView({
              behavior: "smooth",
            })
          }
        })
      })
    }
  
    function initializeAudio() {
      if (bgMusic) {
        bgMusic.volume = 0.3
        playMusicBtn.addEventListener("click", () => {
          if (bgMusic.paused) {
            bgMusic.play()
            playMusicBtn.textContent = "ðŸ”‡ Pausar MÃºsica"
          } else {
            bgMusic.pause()
            playMusicBtn.textContent = "ðŸŽµ Reproducir MÃºsica"
          }
        })
      }
    }
  
    // Simular carga de recursos
    setTimeout(hidePreloader, 2000)
  })
  
  